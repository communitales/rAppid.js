<?xml version="1.0"?>
<js:Application xmlns="http://www.w3.org/1999/xhtml"
                xmlns:js="js.core" xmlns:ui="js.ui">

    <js:Imports>
        js.core.Base;
        js.core.Bindable;
        js.core.List;
    </js:Imports>

    <js:Script>
        <![CDATA[
        (function (Base, Bindable, List) {
            return {
                _defaults:{

                },
                /**
                 * Initializes the app
                 * this method is called right after the script tag is evaluated
                 */
                initialize:function () {
                    this.set("todoList", new TodoList());
                    this.set("newTodo", new Todo());
                },
                translate: function(num){
                    return num === 1 ? 'item' : 'items';
                },
                onAddNewTodo:function (e) {
                    var todo = this.get("newTodo");
                    todo.setInProgress();
                    this.$.todoList.add(todo);
                    this.set("newTodo", new Todo());
                },
                onClearCompleted: function(e){


                },
                onEditTodo: function(e){


                },
                onUpdateTodo: function(e){

                },
                onRemoveTodo: function(e){

                },
                /**
                 * This method should be called from outside to start the application
                 */
                start:function () {

                    // render to body
                    this.render(document.body);
                }
            }
        })
        ]]>
    </js:Script>
    <div class="container">
        <div id="todoapp">
            <div class="title">
                <h1>Todos</h1>
            </div>
            <div class="content">
                <div id="create-todo">
                    <input id="new-todo" placeholder="What needs to be done?" type="text" onkeyup="onAddNewTodo" value="{{newTodo.content}}"/>
                    <span class="ui-tooltip-top" visible="{newTodo.hasContent}">Press Enter to save this task</span>
                </div>

                <div id="todos">
                    <input class="check mark-all-done" type="checkbox" onclick="onClearCompleted"/>
                    <label for="check-all">Mark all as complete</label>
                    <ui:ItemsView items="{todoList}" tagName="ul">
                        <js:Template>
                            <li class="todo">
                                <div class="{$item.status}">
                                    <div class="display">
                                        <input class="check" type="checkbox"/>
                                        <label class="todo-content" ondblclick="onEditTodo">{$item.content}</label>
                                        <span class="todo-destroy" onclick="onRemoveTodo"> </span>
                                    </div>
                                    <div class="edit">
                                        <input class="todo-input" type="text" value="{{$item.content}}" onkeyup="onUpdateTodo"/>
                                    </div>
                                </div>
                            </li>
                        </js:Template>
                    </ui:ItemsView>
                </div>

                <div id="todo-stats">
                    <span class="todo-count">
                        <span class="number">{todoList.numOpenTodos}</span>
                        <span class="word">{translate({todoList.openTodos})}</span>
                        left.
                    </span>
                    <span class="todo-clear" visible="{todoList.areAllComplete()}" onclick="onClearCompleted">

                    </span>

                </div>

            </div>

        </div>
    </div>
</js:Application>