<?xml version="1.0"?>
<ui:View xmlns="http://www.w3.org/1999/xhtml" xmlns:js="js.core" xmlns:ui="js.ui">
    <js:Script><![CDATA[
        (function () {

            var externalLink = /^(([^:]+:\/\/)|(javascript:))/i,
                    stripHashSlash = /^#?\/?/,
                    hashBankUrl = /^#?(.*)$/;

            return {
                defaults: {
                    tagName: 'a',
                    href: null,
                    label: ''
                },
                _renderIconClass: function (iconClass, oldIconClass) {
                    if (iconClass) {
                        this._renderTemplateToPlaceHolder('iconTemplate', 'icon', {$iconClass: iconClass});
                    } else {
                        this.getPlaceHolder("icon").clear();
                    }
                },
                _renderHref: function (href) {
                    if (this.$tagName == "a") {
                        href = href || "javascript:void(0);";

                        if (!(this.$.target === "external" || externalLink.test(href) || this.$.target === "_blank")) {

                            href = "#/" + href.replace(stripHashSlash, '');

                            if (!this.runsInBrowser()) {
                                // node rendering -> hash bang url
                                href = href.replace(hashBankUrl, "#!$1");
                            }
                        }

                        this.$el.setAttribute("href", href);
                    }
                }
            }
        })
        ]]>
    </js:Script>
    <js:Template name="layout">
        <ui:PlaceHolder name="icon"/> {label}
    </js:Template>
    <js:Template name="iconTemplate">
        <i class="{$iconClass}"/>
    </js:Template>
</ui:View>